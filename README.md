# IRCU Patient Flow Modeling Scripts

[![DOI](https://zenodo.org/badge/DOI/{{TU_DOI_ZENODO_FINAL_AQUI}}.svg)](https://doi.org/{{TU_DOI_ZENODO_FINAL_AQUI}})

Code implementing two modeling approaches for IRCU analysis presented in 'IRCU Patient Dynamics and Outcomes in the COVID-19 Pandemic.':

1.  An **ODE model** (`run_ode_simulations.py`, `generate_figures_3_4.py`) simulating patient pathways (X,Y,Z,W,R) and parameter sensitivity (Figs 3-4).
2.  An **LOS-based model** (`LOS_Model.py`) analyzing length-of-stay distributions & simulating bed occupancy via convolution under different scenarios (Fig 5).

Includes necessary input data files.

## Description

This repository contains the Python scripts and input data used for the mathematical modeling and simulation parts of the manuscript: 'IRCU Patient Dynamics and Outcomes in the COVID-19 Pandemic.'.

The main components are:

*   **`run_ode_simulations.py`**: Executes the 5-compartment ODE model (X, Y, Z, W, R) simulating patient flow through the IRCU. It estimates parameters from `patient_data.csv`, runs baseline (A1), variable admission/recovery (B1, B2, B3), and sensitivity analyses (C1-C4). It saves detailed time series and sensitivity summary data as CSV files in `./simulation_results/csv_data/`.
*   **`generate_figures_3_4.py`**: Reads the CSV outputs generated by `run_ode_simulations.py` and uses `matplotlib` to create Figures 3 (A-D: time series for scenarios A1-B3 with annotations) and 4 (A-D: sensitivity analysis plots for gamma and epsilon). Saves plots in `./simulation_results/plots/`.
*   **`LOS_Model.py`**: Performs analysis on the aggregated Length-of-Stay (LOS) data from `ircu_data.csv`. It calculates empirical PMF/Survival functions, fits smoothing models (GP, LOWESS), and simulates total IRCU occupancy using convolution under different admission scenarios. Generates Figure 5 (A-F) and saves plots in `./simulation_results_LOS/plots/` and data in `./simulation_results_LOS/plot_data_csv/`.
*   **`patient_data.csv`**: Input data with individual (anonymized) patient characteristics and outcomes, used for ODE parameter estimation.
*   **`ircu_data.csv`**: Input data with aggregated number of patients per specific Length of Stay, used for the LOS analysis and occupancy simulation.

## Dependencies

The scripts require standard scientific Python libraries:

*   `numpy`
*   `pandas`
*   `matplotlib`
*   `scipy` (specifically `scipy.integrate.solve_ivp` used in `run_ode_simulations.py`)
*   `statsmodels` (specifically `sm.nonparametric.lowess` used in `LOS_Model.py`)
*   `scikit-learn` (specifically `StandardScaler`, `GaussianProcessRegressor`, `kernels` used in `LOS_Model.py`)
*   `seaborn` (Optional, used for styling in `LOS_Model.py`)

You can typically install these using pip:
```bash
pip install numpy pandas matplotlib scipy statsmodels scikit-learn seaborn
```

## Input Data Files

*   **`patient_data.csv`**: Required by `run_ode_simulations.py`. Contains columns like `SRNI`, `UCI`, `EXITUS` (0/1 format). Comma-separated.
*   **`ircu_data.csv`**: Required by `LOS_Model.py`. Contains columns `Dias en IRCU` and `Numero de Pacientes`. Comma-separated.

## How to Run

1.  Ensure all dependencies listed in the "Dependencies" section are installed in your Python environment.
2.  Place the required input data CSV files (`patient_data.csv`, `ircu_data.csv`) in the same directory as the Python scripts.
3.  To generate the ODE simulation results (CSVs) into the `simulation_results/csv_data/` folder, run:
    ```bash
    python run_ode_simulations.py
    ```
4.  To generate Figures 3 and 4 (PNG files) into the `simulation_results/plots/` folder using the previously generated CSVs:
    ```bash
    python generate_figures_3_4.py
    ```
5.  To generate Figure 5 (PNG/JPG files and data CSVs) into the `simulation_results_LOS/` subfolders:
    ```bash
    python LOS_Model.py
    ```

## Outputs

Running the scripts will create the following subdirectories (if they don't exist) relative to the script location:

*   `./simulation_results/csv_data/`: Contains detailed CSV output from `run_ode_simulations.py`.
*   `./simulation_results/plots/`: Contains Figures 3 and 4 (PNG format) generated by `generate_figures_3_4.py`.
*   `./simulation_results_LOS/plots/`: Contains Figure 5 panels (defaulting to JPG, check script config) generated by `LOS_Model.py`.
*   `./simulation_results_LOS/plot_data_csv/`: Contains CSV files with data underlying Figure 5, generated by `LOS_Model.py`.

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## How to Cite

If you use this code or data in your research, please cite the specific version archived on Zenodo:

{{CITA_ZENODO_COMPLETA_AQUI}}

*(Example Format: Navas-Ortega, A. C., Sánchez-Martínez, J. A., García-Flores, P., Morales-García, C., & Fabregas, R. (YYYY). IRCU Patient Dynamics and Outcomes in the COVID-19 Pandemic. (Version ZZZZ) [Software]. Zenodo. https://doi.org/DOI)*

**BibTeX Entry Example:**

```bibtex
@software{NavasOrtega_YYYY_IRCUDynamics,
  author       = {Navas-Ortega, Ana Carmen and Sánchez-Martínez, José Antonio and García-Flores, Paula and Morales-García, Concepción and Fabregas, Rene},
  title        = {{IRCU Patient Dynamics and Outcomes in the COVID-19 Pandemic.}},
  year         = {{YYYY}},
  publisher    = {Zenodo},
  version      = {{ZZZZ}},
  doi          = {{{TU_DOI_ZENODO_FINAL_AQUI}}},
  url          = {https://doi.org/{{TU_DOI_ZENODO_FINAL_AQUI}}}
}
